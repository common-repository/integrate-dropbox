(t=>{"use strict";let o=window.indboxFileSelector,n={init:function(){t(document).on("click",".indbox-tutor-button.video_upload_btn",n.handleVideoSelector),t(document).on("click",".indbox-tutor-remove-button",n.removeVideo),t(document).on("click",".tutorIndboxUploadAttachmentBtn",n.handleAttachmentSelection),t(document).on("click",".tutor-indbox-delete-attachment",n.deleteAttachment),t(window).on("tutor_modal_shown",n.initAttachments),t(".tutor-dashboard-setting-Indbox .remove-account").on("click",n.removeAccount)},removeAccount:function(){var o=this;Swal.fire({title:wp.i18n.__("Are you sure?","integrate-dropbox"),text:wp.i18n.__("You won't be able to revert this!","integrate-dropbox"),icon:"warning",showCancelButton:!0,confirmButtonText:wp.i18n.__("Yes, remove it!","integrate-dropbox"),reverseButtons:!0,showLoaderOnConfirm:!0,customClass:{container:"indbox-swal"},preConfirm:function(){var n=t(o).closest(".indbox-account-item").data("id");return wp.ajax.post("indbox_delete_account",{id:n,nonce:indbox.nonce})}}).then((function(n){n.value&&(t(o).closest(".indbox-account-item").remove(),Swal.fire({title:wp.i18n.__("Removed!","integrate-dropbox"),text:wp.i18n.__("Account has been removed.","integrate-dropbox"),icon:"success",showConfirmButton:!1,timer:1500,toast:!0}))}))},handleVideoSelector:function(e){e.preventDefault();const i=t(this);Swal.fire({html:'<div id="indbox-file-browser" class="indbox-indbox-file-browser-modal-wrap"></div>',showConfirmButton:!1,customClass:{container:"indbox-file-browser-container indbox-toplavel-wrapper"},didOpen:function(){document.getElementById("indbox-file-browser").addEventListener("click",(function(t){t.stopPropagation()})),o({id:"tutor-lms",isMultipleSelect:!1,rootId:"indbox-file-browser",attributes:[],setAttributes:function(t){let o=null,e=null;const a=[];t?.forEach((t=>{"video"===t.indbox_type?e=t:"poster"===t.indbox_type?o=t:"material"===t.indbox_type&&a.push(t)}));const d={id:id,poster:o,video:e,nonce:indbox.nonce};n.addVideo(i,d);const c=i.closest(".tutor_lesson_modal_form");n.addAttachment(c,a),Swal.close()},closeModal:function(){Swal.close()}})}})},addVideo:function(o,e){let i=e.video,a=e.poster,d=i.file_id,c=i.account_id,r=i.name,s=i.size,u=o.closest(".video_source_wrap_indbox"),l="".concat(indbox.ajaxUrl,"?action=indbox_preview_url&id=").concat(d,"&account_id=").concat(c,"&indbox=").concat(e.nonce),m=t('input[name="video[source_indbox]"]',u),v=t('input[name="video[name_indbox]"]',u),p=t('input[name="video[size_indbox]"]',u),b=t(".indbox-tutor-player",u);if(a){let o=a.file_id,n=a.account_id,i="".concat(indbox.ajaxUrl,"?action=indbox_preview_url&id=").concat(o,"&account_id=").concat(n,"&indbox=").concat(e.nonce);t('input[name="video[poster_indbox]"]',u).val(i),b.attr("poster",i)}u.addClass("tutor-has-video"),m.val(l),v.val(r),p.val(s),b.attr("src",l),t(".indbox-tutor-remove-button",u).css("display","inline-flex"),t(".indbox-video-data",u).css("display","block"),t(".indbox-tutor-button.video_upload_btn",u).text("Replace Dropbox Files"),t(".video-data-title",u).text(r),t(".video-data-size",u).text(n.formatSize(s)),b.on("loadedmetadata",(function(){const o=this.duration,e=n.convertSeconds(Math.floor(o)),i=e.hours,a=e.minutes,d=e.seconds,c=u.closest(".tutor_lesson_modal_form").find(".tutor-option-field-video-duration"),r=t('input[name="video[runtime][hours]"]',c);r.length>0&&(i>0?r.val(String(i).padStart(2,"0")):r.val("00"));const s=t('input[name="video[runtime][minutes]"]',c);s.length>0&&(a>0?s.val(String(a).padStart(2,"0")):s.val("00"));var l=t('input[name="video[runtime][seconds]"]',c);l.length>0&&(d>0?l.val(String(d).padStart(2,"0")):l.val("00"))}))},removeVideo:function(o){o.preventDefault();var n=t(this).closest(".video_source_wrap_indbox");n.removeClass("tutor-has-video"),t('input[name="video[source_indbox]"]',n).val(""),t('input[name="video[name_indbox]"]',n).val(""),t('input[name="video[size_indbox]"]',n).val(""),t('input[name="video[poster_indbox]"]',n).val(""),t(".video-data-title",n).text(""),t(".video-data-size",n).text(""),t(".indbox-tutor-player",n).attr("poster",""),t(".indbox-tutor-player",n).attr("src",""),t(".indbox-tutor-remove-button",n).css("display","none"),t(".indbox-video-data",n).css("display","none"),t(".indbox-tutor-button.video_upload_btn",n).text("Add Dropbox Files")},handleAttachmentSelection:function(t){},initAttachments:function(){var o=t(".tutor_lesson_modal_form"),e=o.find('input[type="hidden"][name^="indbox_tutor_attachments"]'),i=[];e.each((function(){var o=t(this),n=o.attr("name").match(/^indbox_tutor_attachments\[(.+?)\]\[(.+?)\]$/);if(n){var e=n[1],a=n[2],d=i.find((function(t){return t.id===e}));d||(d={id:e},i.push(d)),d[a]=o.val()}})),i.length&&n.addAttachment(o,i,!1)},addAttachment:function(o,e,i=!0){let a='<div class="tutor-col-lg-6 tutor-col-xl-4 tutor-mb-16 indbox-tutor-attachment" data-id="">\n    <div class="tutor-card">\n     <div class="tutor-card-body">\n      <div class="tutor-row tutor-align-center">\n       <div class="tutor-col tutor-overflow-hidden">\n       <i class="tutor-icon-brand-Indbox tutor-color-primary"></i>\n        <div class="tutor-fs-6 tutor-fw-medium tutor-color-black tutor-text-ellipsis tutor-mb-4 attachment-name"></div>\n        <div class="tutor-fs-7 tutor-color-muted">'.concat(wp.i18n.__("Size:","integrate-dropbox"),'  <span class="attachment-size"></span></div>\n       </div>\n\n       <div class="tutor-col-auto">\n        <span class="tutor-indbox-delete-attachment tutor-iconic-btn tutor-iconic-btn-secondary" role="button">\n         <span class="tutor-icon-times" aria-hidden="true"></span>\n        </span>\n       </div>\n      </div>\n     </div>\n    </div>\n   </div>'),d=o.find(".tutor-attachment-cards");e.forEach((function(e){var c=e.file_id,r=e.account_id,s=e.name,u=e.size,l=t(a);if(l.attr("data-id",c),l.find(".attachment-name").text(s),l.find(".attachment-size").text(n.formatSize(e.size)),d.append(l),i){var m=t('<input type="hidden" name="indbox_tutor_attachments['.concat(c,'][id]" value="').concat(c,'">')),v=t('<input type="hidden" name="indbox_tutor_attachments['.concat(c,'][accountId]" value="').concat(r,'">')),p=t('<input type="hidden" name="indbox_tutor_attachments['.concat(c,'][name]" value="').concat(s,'">')),b=t('<input type="hidden" name="indbox_tutor_attachments['.concat(c,'][size]" value="').concat(u,'">'));o.append(m,v,p,b)}}))},deleteAttachment:function(o){o.preventDefault();var n=t(this).closest(".tutor-col-lg-6"),e=n.data("id"),i=n.closest(".tutor_lesson_modal_form");i.find('input[name="indbox_tutor_attachments['.concat(e,'][id]"]')).remove(),i.find('input[name="indbox_tutor_attachments['.concat(e,'][accountId]"]')).remove(),i.find('input[name="indbox_tutor_attachments['.concat(e,'][name]"]')).remove(),i.find('input[name="indbox_tutor_attachments['.concat(e,'][size]"]')).remove(),n.remove()},formatSize:function(t){if(t<1)return 0;var o=Math.floor(Math.log(t)/Math.log(1024));return 1*(t/Math.pow(1024,o)).toFixed(2)+" "+["Byte","KB","MB","GB","TB"][o]},convertSeconds:function(t){return{hours:Math.floor(t/3600),minutes:Math.floor(t%3600/60),seconds:t%60}}};t(document).ready(n.init)})(jQuery);